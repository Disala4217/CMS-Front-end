<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>CMS - Assign Courses to Degree Programme</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600&family=Nunito:wght@600;700;800&display=swap" rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet">

    <style>
        .course-entry {
            position: relative;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 5px;
            background-color: #f8f9fa;
        }
        
        .remove-course {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            color: #dc3545;
            font-size: 18px;
        }
        
        .add-course-btn {
            margin-top: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <!-- Spinner Start -->
    <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    <!-- Spinner End -->

    <!-- Navbar Start -->
    <nav class="navbar navbar-expand-lg bg-white navbar-light shadow sticky-top p-0">
        <a href="index.html" class="navbar-brand d-flex align-items-center px-4 px-lg-5">
            <h2 class="m-0 text-primary"><i class="fa fa-book me-3"></i>CMS</h2>
        </a>
        <button type="button" class="navbar-toggler me-4" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav ms-auto p-4 p-lg-0">
                <a href="index.html" class="nav-item nav-link">Home</a>
                <a href="about.html" class="nav-item nav-link">About</a>
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Courses</a>
                    <div class="dropdown-menu fade-down m-0">
                        <a href="insert-course.html" class="dropdown-item">Insert Course</a>
                        <a href="view-all-courses.html" class="dropdown-item">View All Courses</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Degree Programmes</a>
                    <div class="dropdown-menu fade-down m-0">
                        <a href="insert-degree-programme.html" class="dropdown-item">Insert Degree Programme</a>
                        <a href="view-all-degree-programmes.html" class="dropdown-item">View All Degree Programmes</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle active" data-bs-toggle="dropdown">Course Assignments</a>
                    <div class="dropdown-menu fade-down m-0">
                        <a href="assign-courses.html" class="dropdown-item active">Assign Courses</a>
                        <a href="view-all-assignments.html" class="dropdown-item">View All Assignments</a>
                    </div>
                </div>
                <a href="contact.html" class="nav-item nav-link">Contact</a>
            </div>
            <a href="" class="btn btn-primary py-4 px-lg-5 d-none d-lg-block">Join Now<i class="fa fa-arrow-right ms-3"></i></a>
        </div>
    </nav>
    <!-- Navbar End -->

    <!-- Header Start -->
    <div class="container-fluid bg-primary py-5 mb-5 page-header">
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-lg-10 text-center">
                    <h1 class="display-3 text-white animated slideInDown">Assign Courses to Degree Programme</h1>
                    
                </div>
            </div>
        </div>
    </div>
    <!-- Header End -->

    <!-- Assign Courses Start -->
    <div class="container-xxl py-5">
        <div class="container">
            <div class="text-center wow fadeInUp" data-wow-delay="0.1s">
                <h6 class="section-title bg-white text-center text-primary px-3">Course Assignment</h6>
                <h1 class="mb-5">Assign Courses to Degree Programme</h1>
            </div>
            <div class="row g-4 justify-content-center">
                <div class="col-lg-8 col-md-12 wow fadeInUp" data-wow-delay="0.3s">
                    <form id="assignCoursesForm">
                        <div class="row g-3">
                            <div class="col-12">
                                <div class="form-floating">
                                    <select class="form-select" id="degreeProgram" required>
                                    </select>
                                    <label for="degreeProgram">Degree Programme</label>
                                </div>
                            </div>
                            
                            <div class="col-12 mt-4">
                                <h5>Assign Courses</h5>
                                <div id="coursesContainer">
                                    <!-- Course entries will be added here dynamically -->
                                    <div class="course-entry">
                                        <div class="form-floating">
                                            <select class="form-select course-select" required>
                                    
                                            </select>
                                            <label>Course</label>
                                        </div>
                                        <i class="bi bi-x-circle remove-course" onclick="removeCourse(this)"></i>
                                    </div>
                                </div>
                                
                                <button type="button" class="btn btn-secondary add-course-btn" onclick="addCourse()">
                                    <i class="bi bi-plus-circle me-2"></i>Add Another Course
                                </button>
                            </div>
                            
                            <div class="col-12">
                                <button class="btn btn-primary w-100 py-3" type="submit">Assign Courses</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Assign Courses End -->

    <!-- Footer Start -->
    <div class="container-fluid bg-dark text-light footer pt-5 mt-5 wow fadeIn" data-wow-delay="0.1s">
        <!-- Footer content (same as in the original template) -->
    </div>
    <!-- Footer End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/wow/wow.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>

    <!-- Custom Javascript for Course Assignment -->
    <script>

function fetchCourses() {
    fetch("http://localhost:8080/courses")
        .then(response => response.json())
        .then(courses => {
            const courseSelects = document.querySelectorAll(".course-select");
            courseSelects.forEach(select => {
                select.innerHTML = '<option value="" selected disabled>Select Course</option>';
                courses.forEach(course => {
                    select.innerHTML += `<option value="${course.courseID}">${course.courseName}</option>`;
                });
            });
        })
        .catch(error => console.error("Error fetching courses:", error));
}

document.addEventListener("DOMContentLoaded", function () {
    fetchCourses();
});

        // Function to add a new course entry
        function addCourse() {
    fetch("http://localhost:8080/courses")
        .then(response => response.json())
        .then(courses => {
            const coursesContainer = document.getElementById('coursesContainer');
            const courseEntry = document.createElement('div');
            courseEntry.className = 'course-entry';

            let options = '<option value="" selected disabled>Select Course</option>';
            courses.forEach(course => {
                options += `<option value="${course.courseID}">${course.courseName}</option>`;
            });

            courseEntry.innerHTML = `
                <div class="form-floating">
                    <select class="form-select course-select" required>
                        ${options}
                    </select>
                    <label>Course</label>
                </div>
                <i class="bi bi-x-circle remove-course" onclick="removeCourse(this)"></i>
            `;

            coursesContainer.appendChild(courseEntry);
        })
        .catch(error => console.error('Error fetching courses:', error));
}


        // Function to remove a course entry
        function removeCourse(element) {
            const courseEntry = element.parentElement;
            const coursesContainer = document.getElementById('coursesContainer');
            
            // Ensure at least one course entry remains
            if (coursesContainer.children.length > 1) {
                coursesContainer.removeChild(courseEntry);
            } else {
                alert('At least one course must be assigned.');
            }
        } 
    </script>

    <script>
        document.getElementById("assignCoursesForm").addEventListener("submit", function (event) {
    event.preventDefault(); // Prevent form from reloading the page

    const degreeProgram = document.getElementById("degreeProgram").value;
    if (!degreeProgram) {
        alert("Please select a degree program.");
        return;
    }

    const courseSelects = document.querySelectorAll(".course-select");
    let selectedCourses = [];

    courseSelects.forEach(select => {
        if (select.value) {
            selectedCourses.push(parseInt(select.value));
        }
    });

    if (selectedCourses.length === 0) {
        alert("Please select at least one course.");
        return;
    }

    const requestOptions = {
        method: "PUT",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify(selectedCourses),
        redirect: "follow",
    };

    fetch(`http://localhost:8080/degreeProgrammes/${degreeProgram}/courses`, requestOptions)
        .then(response => response.text())
        .then(result => {
            console.log(result);
            alert("Courses successfully assigned!");
        })
        .catch(error => {
            console.error("Error:", error);
            alert("Failed to assign courses. Please try again.");
        });
});

    </script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        fetch("http://localhost:8080/degreeProgrammes")
            .then(response => response.json())
            .then(data => {
                const programmeSelect= document.getElementById("degreeProgram");
                programmeSelect.innerHTML = '<option value="">Select Degree Program</option>';
                console.log(data);
                data.forEach(programme => {
                    const option = document.createElement("option");
                    option.value = programme.programID;
                    option.textContent = programme.programName;
                    programmeSelect.appendChild(option);
                });
            })
            .catch(error => console.error("Error fetching departments:", error));
    });
    </script>
</body>

</html>